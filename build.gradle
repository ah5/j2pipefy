apply plugin: 'base'
apply plugin: 'groovy'
apply plugin: 'java'
apply plugin: 'war'

repositories {
    mavenCentral()
    jcenter()
    maven { url 'http://repo.jenkins-ci.org/releases/' }
}

dependencies {
    compile 'org.codehaus.groovy:groovy-all:2.4.15'
    compile 'org.jenkins-ci.plugins:credentials-binding:1.16'
}

sourceSets {
    main {
        groovy {
            srcDirs = ['src', 'vars']
            exclude '**/validefy.groovy'
        }
    }
}

clean.doFirst {
    println "Removing build dir ..."
    delete "${buildDir}"
    println "Removing docs artifacts ..."
    delete fileTree(rootDir) { 
        include "docs/web/*.html"
        include "docs/web/*.ico"
        include "docs/web/*.gif"
        include "docs/web/*.css"
        include "docs/web/package-list"
        include "docs/web/DefaultPackage/"
    }
}

compileGroovy.dependsOn clean

groovydoc {
    dependsOn compileGroovy
    docTitle = description
    source = sourceSets.main.groovy
    destinationDir = new File('docs/web')
    classpath = configurations.compile
}

war {
    dependsOn groovydoc
    from 'docs/web'
    webInf {
        from 'docs/web/WEB-INF'
    }
    webXml = file('docs/web/WEB-INF/web.xml')
}

build.dependsOn clean, war